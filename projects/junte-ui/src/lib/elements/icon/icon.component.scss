@import "jnt-variables";
@import "jnt-functions";
@import "elements/icon/svg/svg-icon";
@import "elements/icon/font/font-icon";
@import "elements/icon/animated/animated-icon";

@mixin jnt-icon($passed: (), $context: null, $deep: false, $strategy: 'changes') {
  $defs: (
    color: null,
    size: null,
    sizes: (
      auto: (
        size: 22px,
      ),
      tiny: (
        size: 11px,
      ),
      small: (
        size: 13px,
      ),
      normal: (
        size: 16px,
      ),
      large: (
        size: 20px,
      )
    )
  );

  $vars: $passed;
  $declare: false;

  $wrapper: null;
  @if $deep {
    $wrapper: '::ng-deep';
  }

  @if $passed == () or $strategy == 'merge' {
    $vars: recursive-map-merge($defs, $passed);
    $declare: true;
  }

  :host, #{$context} {
    @if $declare {
      display: inline-flex;
      vertical-align: middle;
    }

    &[data-type='font'] {
      #{$wrapper} [data-icon] {
        @include jnt-font-icon((
          color: map-get($vars, color),
          font-size: if(map-get($vars, size), map-get($vars, size) !important, null),
        ), '&');
      }
    }

    &[data-type='animated'] {
      #{$wrapper} [data-icon] {
        @include jnt-animated-icon((
          fill: map-get($vars, color),
        ), '&');
        @if map-has-key($vars, size) {
          @include jnt-animated-icon((
            width: if(map-get($vars, size), map-get($vars, size) !important, null),
            height: if(map-get($vars, size), map-get($vars, size) !important, null)
          ), '&');
        }
      }
    }

    &[data-type='svg'] {
      #{$wrapper} [data-icon] {
        @include jnt-svg-icon((
          fill: map-get($vars, color),
        ), '&');
        @if map-has-key($vars, size) {
          @include jnt-svg-icon((
            width: if(map-get($vars, size), map-get($vars, size) !important, null),
            height: if(map-get($vars, size), map-get($vars, size) !important, null)
          ), '&');
        }
      }
    }

    @if map-has-key($vars, sizes) {
      @each $key, $size in map-get($vars, sizes) {
        &[data-size='#{$key}'] {
          &[data-type='font'] {
            &:not([data-size='auto']) {
              #{$wrapper} [data-icon] {
                @include jnt-font-icon((
                  font-size: map-get($size, size)
                ), '&');
              }
            }
          }

          &[data-type='animated'] {
            #{$wrapper} [data-icon] {
              @include jnt-animated-icon((
                width: map-get($size, size),
                height: map-get($size, size),
              ), '&');
            }
          }

          &[data-type='svg'] {
            #{$wrapper} [data-icon] {
              @include jnt-svg-icon((
                width: map-get($size, size),
                height: map-get($size, size),
              ), '&');
            }
          }
        }
      }
    }
  }
}
