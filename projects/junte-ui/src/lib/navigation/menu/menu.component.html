<jnt-stack [orientation]="orientation"
           [gutter]="spacing"
           [align]="ui.align.stretch"
           [wrap]="ui.wrap.wrap">
  <ng-container *ngFor="let item of items">
    <div data-top [attr.data-disabled]="item.disabled">
      <div data-item [attr.data-loading]="item.loading" (click)="toggle(item)"
           [jntPopover]="{
              contentTemplate: collapsed || (orientation === orientationEnum.horizontal && !!item.submenu)
                ? submenuTemplate : null,
              position: orientation === orientationEnum.vertical
                ? ui.position.right
                : ui.position.bottom,
              trigger: orientation === orientationEnum.horizontal || !collapsed
                ? ui.trigger.click
                : ui.trigger.hover,
              features: features,
              placement: placement
            }">
        <jnt-spinner *ngIf="item.loading" [size]="ui.size.small"></jnt-spinner>
        <jnt-link data-link
                  [title]="!collapsed ? item.title : null"
                  [icon]="item.icon"
                  [matching]="item.matching"
                  [source]="!item.submenu ? item.link : null"
                  [fragment]="item.fragment"
                  [scheme]="item.scheme"
                  [outline]="ui.outline.transparent"
                  [target]="item.target"
                  (click)="!item.submenu ? selected.emit(item) : null;item.click.emit()">
          <ng-container *ngIf="!collapsed">
            <jnt-badge *ngFor="let badge of item.badges"
                       [value]="badge.value"
                       [text]="badge.text"
                       [position]="ui.position.inline"
                       [color]="badge.color">
            </jnt-badge>
          </ng-container>
        </jnt-link>
        <jnt-icon *ngIf="!!item.submenu" [icon]="ui.icons.chevronDown" data-toggle></jnt-icon>
      </div>

      <ng-container *ngIf="!collapsed && orientation === orientationEnum.vertical && item.opened">
        <ng-container *ngTemplateOutlet="submenuTemplate;context: {headless: true}"></ng-container>
      </ng-container>

      <ng-template #submenuTemplate let-headless=headless>
        <div data-sub
             [attr.data-opened]="item.opened"
             [attr.data-orientation]="orientation"
             [attr.data-collapsed]="collapsed">
          <ng-container *ngIf="!!item.submenu; else only">
            <div data-section *ngIf="!headless">
              <span>
                {{item.title}}
              </span>
            </div>
            <jnt-link data-link *ngFor="let subItem of item.submenu.items"
                      [title]="subItem.title"
                      [icon]="subItem.icon"
                      [matching]="subItem.matching"
                      [source]="subItem.link"
                      [fragment]="subItem.fragment"
                      [scheme]="subItem.scheme"
                      [target]="subItem.target"
                      (click)="selected.emit(item);item.click.emit()">
              <jnt-badge *ngFor="let badge of subItem.badges"
                         [value]="badge.value"
                         [text]="badge.text"
                         [position]="ui.position.inline"
                         [color]="badge.color">
              </jnt-badge>
            </jnt-link>
          </ng-container>

          <ng-template #only>
            <jnt-link data-link
                      [title]="item.title"
                      [icon]="item.icon"
                      [matching]="item.matching"
                      [source]="item.link"
                      [scheme]="item.scheme"
                      [target]="item.target">
              <jnt-badge *ngFor="let badge of item.badges"
                         [value]="badge.value"
                         [text]="badge.text"
                         [position]="ui.position.inline"
                         [color]="badge.color">
              </jnt-badge>
            </jnt-link>
          </ng-template>
        </div>
      </ng-template>
    </div>
  </ng-container>
</jnt-stack>
