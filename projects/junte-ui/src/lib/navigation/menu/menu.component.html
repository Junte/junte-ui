<jnt-stack [orientation]="style === styleEnum.tabs ? ui.orientation.horizontal : orientation"
           [gutter]="spacing"
           [align]="ui.align.stretch"
           [wrap]="ui.wrap.wrap">
  <ng-container *ngFor="let item of items">
    <div data-top>
      <div data-item [attr.data-loading]="item.loading" (click)="toggle(item)"
           [jntPopover]="{
              contentTemplate: submenuTemplate,
              position: orientation === orientationEnum.vertical
                ? ui.position.right
                : ui.position.bottom,
              trigger: orientation === orientationEnum.horizontal || !collapsed
                ? ui.trigger.click
                : ui.trigger.hover,
              behaviour: ui.behaviour.dropdown,
              placement: placement,
              active: !!item.submenu && (collapsed || orientation === orientationEnum.horizontal)
            }"
           (attached)="reference.popover = $event"
           (removed)="reference.popover = null">
        <jnt-spinner *ngIf="item.loading" data-spinner [size]="ui.size.small"></jnt-spinner>
        <jnt-link data-link
                  [title]="!collapsed ? item.title : null"
                  [icon]="item.icon"
                  [matching]="item.matching"
                  [source]="!item.submenu ? item.link?.source : null"
                  [fragment]="item.link?.fragment"
                  [scheme]="item.scheme"
                  [outline]="ui.outline.transparent"
                  [target]="item.target"
                  [disabled]="item.disabled"
                  [features]="!!item.submenu ? [ui.feature.dropdown] : null"
                  (click)="item.click.emit(); !item.submenu ? selected.emit(item) : null">
          <ng-container *ngIf="!collapsed">
            <jnt-badge *ngFor="let badge of item.badges"
                       [value]="badge.value"
                       [text]="badge.text"
                       [position]="ui.position.inline"
                       [color]="badge.color">
            </jnt-badge>
          </ng-container>
        </jnt-link>
      </div>

      <ng-container *ngIf="!collapsed && orientation === orientationEnum.vertical && item.opened">
        <ng-container *ngTemplateOutlet="submenuTemplate;context: {headless: true}"></ng-container>
      </ng-container>

      <ng-template #submenuTemplate let-headless=headless>
        <div data-sub
             [attr.data-opened]="item.opened"
             [attr.data-orientation]="orientation"
             [attr.data-collapsed]="collapsed">
          <ng-container *ngIf="!!item.submenu">
            <div data-section *ngIf="!headless">
              <span>
                {{item.title}}
              </span>
            </div>
            <jnt-link data-link *ngFor="let subItem of item.submenu.items"
                      [title]="subItem.title"
                      [icon]="subItem.icon"
                      [matching]="subItem.matching"
                      [source]="subItem.link?.source"
                      [fragment]="subItem.link?.fragment"
                      [disabled]="subItem.disabled"
                      [scheme]="subItem.scheme"
                      [target]="subItem.target"
                      (click)="selected.emit(item); item.click.emit(); reference.popover?.hide();">
              <jnt-badge *ngFor="let badge of subItem.badges"
                         [value]="badge.value"
                         [text]="badge.text"
                         [position]="ui.position.inline"
                         [color]="badge.color">
              </jnt-badge>
            </jnt-link>
          </ng-container>
        </div>
      </ng-template>
    </div>
  </ng-container>
</jnt-stack>
