<ng-template #loadTemplate>
  <tr loading>
    <td [attr.colspan]="columns?.length">
      <jnt-skeleton [title]="false" [rows]=3></jnt-skeleton>
    </td>
  </tr>
</ng-template>

<jnt-stack [align]="ui.flex.align.stretch">
  <jnt-stack [type]="ui.stack.type.horizontal" [justify]="ui.flex.justify.between">
    <jnt-stack [type]="ui.stack.type.horizontal">
      <jnt-button button text="Reload"
                  [icon]="ui.icons.reload"
                  [outline]="ui.outline.transparent"
                  [scheme]="ui.schemes.secondary"
                  (click)="load()">
      </jnt-button>
      <ng-container *ngTemplateOutlet="actionsTemplate"></ng-container>
    </jnt-stack>

    <jnt-stack [type]="ui.stack.type.horizontal">
      <ng-container *ngTemplateOutlet="filtersTemplate"></ng-container>
      <jnt-input *ngIf="search" [icon]="ui.icons.search" placeholder="Search"></jnt-input>
    </jnt-stack>
  </jnt-stack>

  <form [formGroup]="filterForm">
    <jnt-stack [align]="ui.flex.align.stretch">

      <table>
        <thead>
        <tr>
          <th *ngFor="let column of columns"
              [class.sortable]="!!column.sort"
              (click)="column.sort ? sorting(column.sort) : null">
        <span>
          {{column.title}}
          <i *ngIf="!!sort && sort.value === column.sort"
             [innerHTML]="order.value === 'asc' ? '&#8593;' : '&#8595;'"></i>
        </span>
          </th>
        </tr>
        </thead>

        <tbody>
        <ng-container *ngIf="!progress.loading; else loadTemplate">
          <tr *ngIf="!source.length" nodata>
            <td [attr.colspan]="columns.length">
              <jnt-icon [icon]="ui.icons.nodata" icon></jnt-icon>
              <div message>No rows here</div>
            </td>
          </tr>
          <tr *ngFor="let row of source; let i = index" [class.even]="!(i % 2)">
            <td *ngFor="let column of columns">
              <ng-container *ngTemplateOutlet="column.cellTemplate;context:row"></ng-container>
            </td>
          </tr>
        </ng-container>
        </tbody>
      </table>

      <ng-container *ngIf="count && !progress.loading && source.length">
        <div pagination>
          <jnt-pagination [pagesCount]="pagesCount" formControlName="page" pages></jnt-pagination>
          <jnt-page-size formControlName="pageSize" page-size></jnt-page-size>
        </div>
      </ng-container>
    </jnt-stack>
  </form>
</jnt-stack>
