<ng-template #ajaxOptionsTemplate>
  <li item *ngFor="let option of ajaxOptions" (click)="optionSelect(option[valueField])">
    {{option[labelField]}}
  </li>
</ng-template>

<ng-template #optionsTemplate>
  <li item *ngFor="let option of options" (click)="optionSelect(option[valueField])">
    <jnt-checkbox checkbox [checked]="!!selected[option[valueField]]">
      {{option[labelField]}}
    </jnt-checkbox>
  </li>
</ng-template>

<ng-template #singleMode>
  <li><span></span></li>
</ng-template>

<ng-template #selectedItemsTemplate>
  <ul selection *ngIf="!loading; else loadOptionsTemplate">
    <li *ngFor="let item of selectedItems" [attr.chips]="selectMode.multiple === mode">
      <span>{{labels[item]}}</span>
      <button (click)="optionSelect(item)">
        <jnt-icon close [icon]="ui.icons.close"></jnt-icon>
      </button>
    </li>
    <li>
      <input #searchInput input jntSmartWidth (click)="toggle = !toggle"
             [ngModel]="q"
             (ngModelChange)="search$.next($event)"
             [disabled]="!search">
      <ng-container *ngTemplateOutlet="placeholderTemplate"></ng-container>
    </li>
  </ul>
</ng-template>

<ng-template #placeholderTemplate>
  <div *ngIf="placeholderVisible" placeholder>{{placeholder}}</div>
</ng-template>

<ng-template #loadTemplate>
  <jnt-spinner [size]="ui.sizes.normal"></jnt-spinner>
</ng-template>

<ng-template #loadOptionsTemplate>
  <jnt-spinner></jnt-spinner>
</ng-template>

<ng-template #itemsNotFoundTemplate>
  <li message *ngIf="!!q && !options.length">Items not found</li>
</ng-template>

<div *ngIf="toggle" overlay (click)="toggle = !toggle"></div>

<div selectize (click)="input.focus(); toggle = !toggle;">
  <ng-container *ngTemplateOutlet="selectedItemsTemplate"></ng-container>
  <jnt-icon icon [icon]="ui.icons.sortDown"></jnt-icon>
  <ng-container *ngIf="!!toggle">
    <div options>
      <div *ngIf="loading" loading>
        <ng-container *ngTemplateOutlet="loadTemplate"></ng-container>
      </div>
      <ul>
        <ng-container *ngTemplateOutlet="itemsNotFoundTemplate"></ng-container>
        <ng-container *ngTemplateOutlet="optionsTemplate"></ng-container>
        <ng-container *ngTemplateOutlet="ajaxOptionsTemplate"></ng-container>
      </ul>
    </div>
  </ng-container>
</div>

<ng-content></ng-content>
