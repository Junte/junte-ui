<ng-template #optionDefaultTemplate let-label="label">
  {{label}}
</ng-template>

<div select [attr.focused]="focused" tabindex="0">
  <div *ngIf="label" label>{{label}}</div>
  <ul *ngIf="selected.length" [type]="ui.stack.type.horizontal">
    <li *ngFor="let key of selected">
      <ng-template #noOptionTemplate>
        <jnt-skeleton empty [type]="ui.skeleton.type.text"></jnt-skeleton>
      </ng-template>
      <div *ngIf="(key | getOption:options:changes.selected:changes.options) as option;else noOptionTemplate">
        <ng-container
          *ngTemplateOutlet="!!optionTemplate ? optionTemplate : optionDefaultTemplate;context: option"></ng-container>
      </div>
      <button (click)="remove(key)">
        <jnt-icon [icon]="ui.icons.close"></jnt-icon>
      </button>
    </li>
  </ul>
  <div query [formGroup]="form" (click)="opened = true">
    <input [placeholder]="!selected.length ? placeholder : ''"
           formControlName="query">
  </div>
  <button toggle (click)="opened = !opened">
    <jnt-icon [icon]="opened ? ui.icons.chevronUp : ui.icons.chevronDown"></jnt-icon>
  </button>
</div>
<div options *ngIf="opened">
  <ng-template #noOptionsTemplate>
    <jnt-skeleton *ngIf="loading; else emptyOptions"
                  [type]="ui.skeleton.type.text" [lines]="5"></jnt-skeleton>
    <ng-template #emptyOptions>
      <jnt-icon [icon]="ui.icons.stopping"></jnt-icon>
    </ng-template>
  </ng-template>
  <ng-container
    *ngIf="((!!queryControl.value ? options.found : options.persisted) | getOptions:selected:changes.selected:changes.options) as options">
    <ul *ngIf="options.length;else noOptionsTemplate">
      <div loading *ngIf="loading">
        <jnt-spinner [size]="ui.sizes.small"></jnt-spinner>
      </div>
      <ng-container *ngFor="let o of options">
        <li (click)="add(o)">
          <ng-container
            *ngTemplateOutlet="!!optionTemplate ? optionTemplate : optionDefaultTemplate;context: o"></ng-container>
        </li>
      </ng-container>
    </ul>
  </ng-container>
</div>

<ng-content></ng-content>
