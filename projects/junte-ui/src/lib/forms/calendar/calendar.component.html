<table>
  <thead>
  <tr>
    <td>
      <jnt-button data-arrow [icon]="ui.icons.chevronLeft"
                  [outline]="ui.outline.transparent"
                  [size]="ui.size.small"
                  (click)="view === viewType.date ? period = subMonths(period, 1) : view === viewType.month ?
                  period = subYears(period, 1) : period = subYears(period, 12)">
      </jnt-button>
    </td>
    <td *ngIf="view === viewType.date" (click)="view = viewType.month" colspan="5">
      <jnt-button data-date [outline]="ui.outline.transparent"
                  [size]="ui.size.small"
                  [width]="ui.width.fluid"
                  text="{{period | dfnsFormat: 'LLLL'}}, {{period | dfnsFormat: 'yyyy'}}"></jnt-button>
    </td>
    <td *ngIf="view === viewType.month" (click)="view = viewType.year" colspan="2">
      <jnt-button data-date [outline]="ui.outline.transparent"
                  [size]="ui.size.small"
                  [width]="ui.width.fluid"
                  text="{{period | dfnsFormat: 'yyyy'}}">
      </jnt-button>

    </td>
    <td *ngIf="view === viewType.year" colspan="2" data-year>
      {{getYear(period) - 4}} - {{getYear(period) + 7}}
    </td>
    <td>
      <jnt-button data-arrow [icon]="ui.icons.chevronRight"
                  [outline]="ui.outline.transparent"
                  [size]="ui.size.small"
                  (click)="view === viewType.date ? period = addMonths(period, 1) : view === viewType.month ?
                  period = addYears(period, 1) : period = addYears(period, 12)">
      </jnt-button>
    </td>
    <td *ngIf="metrics.length"
        [translate]="'label.metrics'"
        [attr.colspan]="metrics.length">
      Metrics
    </td>
  </tr>
  <tr *ngIf="view === viewType.date; else empty" data-days>
    <th *ngFor="let weekDay of [0,1,2,3,4,5,6]">{{weekDay | dfnsWeekdayName:'x2'}}</th>

    <th *ngFor="let m of metrics">
      {{m.title}}
    </th>
  </tr>

  <ng-template #empty>
    <tr data-days>
      <th *ngFor="let col of [1,2,3,4]"></th>
    </tr>
  </ng-template>
  </thead>

  <tbody>
  <ng-container *ngIf="view === viewType.date">
    <tr *ngFor="let w of weeks"
        [attr.data-current-week]="(current | dfnsStartOfWeek) | dfnsIsEqual: (w.date | dfnsStartOfWeek)">
      <td data-day *ngFor="let d of w.days"
          [attr.data-current-day]="(d | dfnsStartOfDay) | dfnsIsEqual: (current | dfnsStartOfDay)"
          (click)="select(d)" tabindex="0">
        <ng-container
          *ngTemplateOutlet="!!calendarDayTemplate ? calendarDayTemplate: defaultDayTemplate;context:{date: d}">
        </ng-container>
      </td>

      <td data-metric *ngFor="let m of metrics;let i = index;">
        <ng-container *ngTemplateOutlet="calendarMetricTemplate;context:{metric: i, date: w.date}">
        </ng-container>
      </td>
    </tr>
  </ng-container>

  <ng-container *ngIf="view === viewType.month">
    <tr *ngFor="let row of months">
      <td data-day-extend *ngFor="let month of row"
          [attr.data-current-month]="(month | dfnsStartOfMonth) | dfnsIsEqual: (current | dfnsStartOfMonth)"
          (click)="period = month; view = viewType.date">
        {{month | dfnsFormat: 'LLL'}}
      </td>
    </tr>
  </ng-container>

  <ng-container *ngIf="view === viewType.year">
    <tr *ngFor="let row of years">
      <td data-day-extend *ngFor="let year of row"
          [attr.data-current-year]="(year | dfnsStartOfYear) | dfnsIsEqual: (current | dfnsStartOfYear)"
          (click)="period = year; view = viewType.month">
        {{year | dfnsFormat: 'yyyy'}}
      </td>
    </tr>
  </ng-container>

  </tbody>
</table>

<ng-template #defaultDayTemplate let-date="date">
  <div data-default>{{date | dfnsGetDate}}</div>
</ng-template>

