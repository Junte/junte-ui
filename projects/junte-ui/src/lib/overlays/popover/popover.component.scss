@import "jnt-variables";
@import "jnt-functions";

@mixin popover-scheme($scheme) {
  [data-wrapper] {
    background-color: map-get($scheme, background-color);
    [data-title] {
      color: map-get($scheme, color);
    }
  }
  [data-arrow] {
    border-top-color: map-get($scheme, background-color);
  }
  [data-title] {
    color: map-get($scheme, color);
  }
}

@mixin jnt-popover($passed: (), $context: null, $strategy: 'changes') {

  $defs: (
    spacing: 14px,
    arrow-shift: $jnt-gutter-normal,
    schemes: (
      primary: (
        background-color: $jnt-primary-light-color,
        color: $jnt-white-color
      ),
      secondary: (
        background-color: $jnt-secondary-background,
        color: $jnt-primary-text-color
      ),
      success: (
        background-color: $jnt-success-color,
        color: $jnt-white-color
      ),
      fail: (
        background-color: $jnt-fail-color,
        color: $jnt-white-color
      ),
    ),
  );

  $vars: $passed;
  $declare: false;

  @if $passed == () or $strategy == 'merge' {
    $vars: recursive-map-merge($defs, $passed);
    $declare: true;
  }

  :host, #{$context} {
    position: absolute;
    z-index: 100;
    user-select: text;
    display: block;

    @if map-has-key($vars, schemes) {
      @each $scheme, $map in map-get($vars, schemes) {
        &[data-scheme='#{$scheme}'] {
          @include popover-scheme($map);
        }
      }
    }

    [data-arrow] {
      width: 0;
      height: 0;
      border: 10px solid transparent;
      position: absolute;
      display: none;
    }

    &.top,
    &.top-left,
    &.top-right {
      padding-bottom: map-get($vars, spacing);

      [data-arrow] {
        top: calc(100% - #{map-get($vars, spacing)});
      }
    }

    &.right,
    &.right-top,
    &.right-bottom {
      padding-left: map-get($vars, spacing);

      [data-arrow] {
        right: calc(100% - #{map-get($vars, spacing)});
      }
    }

    &.bottom,
    &.bottom-left,
    &.bottom-right {
      padding-top: map-get($vars, spacing);

      [data-arrow] {
        bottom: calc(100% - #{map-get($vars, spacing)});
      }
    }

    &.left,
    &.left-top,
    &.left-bottom {
      padding-right: map-get($vars, spacing);

      [data-arrow] {
        left: calc(100% - #{map-get($vars, spacing)});
      }
    }

    &.top,
    &.bottom {
      [data-arrow] {
        left: 50%;
      }
    }

    &.left,
    &.right {
      [data-arrow] {
        top: 50%;
      }
    }

    &.top-left,
    &.bottom-left {
      [data-arrow] {
        left: map-get($vars, arrow-shift);
      }
    }

    &.top-right,
    &.bottom-right {
      [data-arrow] {
        right: map-get($vars, arrow-shift);
      }
    }

    &.left-top,
    &.right-top {
      [data-arrow] {
        top: map-get($vars, arrow-shift);
      }
    }

    &.left-bottom,
    &.right-bottom {
      [data-arrow] {
        bottom: map-get($vars, arrow-shift);
      }
    }

    &.right-top,
    &.right-bottom {
      [data-arrow] {
        transform: rotate(90deg);
      }
    }

    &.bottom-left,
    &.bottom-right {
      [data-arrow] {
        transform: rotate(180deg);
      }
    }

    &.left-top,
    &.left-bottom {
      [data-arrow] {
        transform: rotate(-90deg);
      }
    }

    &.top [data-arrow] {
      transform: translateX(-50%);
    }

    &.right [data-arrow] {
      transform: translateY(-50%) rotate(90deg);
    }

    &.bottom [data-arrow] {
      transform: translateX(-50%) rotate(180deg);
    }

    &.left [data-arrow] {
      transform: translateY(-50%) rotate(-90deg);
    }
  }

  #{$context} [data-wrapper] {
    border-radius: $jnt-corner-small;
    box-shadow: $jnt-shadow-normal;
    padding: $jnt-gutter-normal;

    [data-title] {
      font-weight: $jnt-font-weight-bold;
      margin-bottom: $jnt-gutter-normal;
    }
    [data-content] {
      max-width: 300px;
    }
  }
}
